# æ™ºèƒ½æŒ‡é’ˆ

**å®šä¹‰**ï¼šå®ç°`new`å’Œ`delete`è‡ªåŠ¨åŒ–çš„ä¸€ç§æ–¹å¼.

â€‹			æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸå§‹æŒ‡é’ˆçš„åŒ…è£….

## æ™ºèƒ½æŒ‡é’ˆstd::unique_ptr

æœ€ç®€å•çš„æ™ºèƒ½æŒ‡é’ˆ.

**åŠŸèƒ½**ï¼šè¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨`delete`.

**ä¸ºä»€ä¹ˆå«unique pointer?**  å› ä¸ºä½ ä¸èƒ½å¤åˆ¶`std::unique_ptr`ï¼Œå› ä¸ºå½“ä»–è¢«é‡Šæ”¾æ—¶ï¼Œå…¶ä»–å‰¯æœ¬ä¼šæŒ‡å‘é‚£å—è¢«é‡Šæ”¾çš„ç©ºå†…å­˜. å®ƒæ˜¯ä½ çš„å”¯ä¸€å‚è€ƒ. å®é™…ä¸Šï¼Œå®ƒæŠŠè‡ªå·±çš„å¤åˆ¶åŠŸèƒ½`delete`æ‰äº†ï¼Œé˜²æ­¢ä½ åšå‡ºå¤åˆ¶å®ƒè¿™ç§è ¢äº‹. (ä½ å¯èƒ½ä¼šä¸ç»æ„é—´æƒ³ â€å…±äº«è¿™ç§æŒ‡é’ˆâ€œ è€ŒçŠ¯è¿™ç§è ¢äº‹ï¼Œå¦‚æœä½ çœŸçš„æƒ³â€œå…±äº«â€ï¼Œè¯·ç”¨`shared_ptr`)

**å®ç°**ï¼šè°ƒç”¨`<memory>`åº“

```cpp
#include<memory>
std::unique_ptr<ClassName/TypeName> VarName(new ClassName()/*åªè¦æ˜¯æ„é€ å‡½æ•°å³å¯*/);//OK
std::unique_ptr<ClassName/TypeName> VarName = new ClassName;//æŠ¥é”™ï¼Œunique_ptrç¦ç”¨éšå¼è½¬æ¢
std::unique_ptr<ClassName/TypeName> VarName = std::make_unique<ClassName/TypeName>();
//ğŸ†—ä¸”æ›´å¥½æ›´å¿«ï¼Œä¸»è¦åŸå› æ˜¯å¤„äº"å¼‚å¸¸å®‰å…¨"ï¼Œå³å½“ç±»æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶æ›´åŠ å®‰å…¨ï¼Œå®ƒä¸ä¼šå¾—åˆ°ä¸€ä¸ªæ²¡æœ‰å¼•ç”¨çš„æ‚¬ç©ºæŒ‡é’ˆï¼Œé€ æˆå†…å­˜æ³„éœ²
```

------

e.g.

```cpp
#include<iostream>
#include<memory>

class Knob {
public:
    Knob() {
        std::cout << "Knob constructed!" << std::endl;
    }
    ~Knob() {
        std::cout << "Knob destroyed!" << std::endl;
    }
};

int main() {
    {
        std::unique_ptr<Knob> knob(new Knob());
    }
}
```

è¾“å‡ºï¼š

```
Knob constructed!
Knob destroyed!
```

------

`std::unique_ptr`ä½å¼€é”€ç”šè‡³**æ²¡æœ‰å¼€é”€**.



## æ™ºèƒ½æŒ‡é’ˆæ˜¯std::shared_ptr

**åŸç†**ï¼šç›¸æ¯”`std::unique_ptr`æ–°å¢**å¼•ç”¨è®¡æ•°**ï¼Œ

â€‹			ä»–å¯ä»¥è·Ÿè¸ªä½ çš„æŒ‡é’ˆæœ‰å¤šå°‘å¼•ç”¨ï¼Œä¸€æ—¦å¼•ç”¨è®¡æ•°è¾¾åˆ°é›¶ï¼ŒæŒ‡é’ˆæ‰è¢«åˆ é™¤.

**å®ç°**ï¼šè°ƒç”¨`<memory>`åº“

```cpp
#include<memory>
std::shared_ptr<ClassName/TypeName> VarName(new ClassName()/*åªè¦æ˜¯æ„é€ å‡½æ•°å³å¯*/);//OK
std::shared_ptr<ClassName/TypeName> VarName = std::make_shared<ClassName/TypeName>();
//ğŸ†—ä¸”æ›´å¥½ï¼Œä¸unique_pträ¸åŒï¼Œå› ä¸ºshare_ptréœ€è¦åˆ†é…å¦ä¸€å—å†…å­˜(å«åšæ§åˆ¶å—),ç”¨æ¥å­˜å‚¨å¼•ç”¨è®¡æ•°ã€‚ç›´æ¥newå†èµ‹å€¼éœ€è¦åˆ†é…ä¸¤æ¬¡å†…å­˜ï¼Œç›¸æ¯”make_sharedæ›´æœ‰æ•ˆç‡
```

------

**ç†è§£å¼•ç”¨è®¡æ•°**ï¼šè¯·æ‰“å¼€<è°ƒè¯•>æˆ–<å†…å­˜>

```cpp
#include<iostream>
#include<memory>

class Knob {
public:
    Knob() {
        std::cout << "Knob constructed!" << std::endl;
    }
    ~Knob() {
        std::cout << "Knob destroyed!" << std::endl;
    }
};

int main() {
    {
        std::shared_ptr<Knob> knob0;
        {
            std::shared_ptr<Knob> knob = std::make_shared<Knob>();//è¾“å‡ºKnob constructed!
            knob0 = knob;
        }//æ²¡æœ‰ååº”
    }//æ²¡æœ‰ååº”(æ­¤è¡Œè¿˜æœªè¢«æ‰§è¡Œæ—¶)
    //è¾“å‡ºKnob destroyed!
    std::cin.get();
}
```

`std::shared_ptr`æœ‰ä¸€å®šå¼€é”€ï¼Œå› ä¸ºå®ƒçš„**å¼•ç”¨è®¡æ•°**åŠŸèƒ½.



## æ™ºèƒ½æŒ‡é’ˆstd::weak_ptr

**åŠŸèƒ½**ï¼šä¸`std::shared_ptr`é…å¥—ä½¿ç”¨ï¼Œè·Ÿ`std::shared_ptr`æ‰€åšçš„äº‹å¤§è‡´ä¸€æ ·ï¼Œ

â€‹			ä½†æ˜¯ä»–**ä¸å¢åŠ å¼•ç”¨è®¡æ•°**.