# å¤åˆ¶ & æ‹·è´æ„é€ å‡½æ•°

## å¤åˆ¶

å¯¹äºæŒ‡é’ˆï¼Œåˆ†ä¸º**æµ…æ‹·è´**å’Œ**æ·±æ‹·è´**.

+ æµ…æ‹·è´

	åªæ˜¯è®©å‰¯æœ¬æŒ‡é’ˆè¢«åŸæŒ‡é’ˆå¤åˆ¶ï¼Œä¸¤ä¸ªæŒ‡é’ˆå®é™…ä¸ŠæŒ‡å‘åŒä¸€åœ°å€ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªçš„å†…å®¹åˆ™ä¿®æ”¹è¡Œä¸ºä¼šè¢«åŒæ­¥.

	```cpp
	int* a;
	*a = 1;//åˆå§‹åŒ–a
	std::cout << "a = " << *a << std::endl;
	int* b = a;//ç”¨bæµ…æ‹·è´a
	b++;//æ›´æ”¹b
	std::cout << "a = " << *a << std::endl;//aä¹Ÿè¢«åŒæ­¥ä¿®æ”¹
	delete a;delete b;
	```

	è¾“å‡ºï¼š

	```
	1
	2
	```

+ æ·±æ‹·è´

	è®©æŒ‡é’ˆå†…å®¹è¢«å®Œæ•´æ‹·è´ï¼Œæ”¾åˆ°å¦å¤–åœ°å€.



------

æµ…æ‹·è´æœ‰æ—¶ä¼šé€ æˆ**ç¨‹åºå´©æºƒ**ï¼šè¿™æ˜¯Chernoè‡ªå†™Stringä½œä¸ºçš„ä¾‹å­ï¼š

```cpp
#include<iostream>
#include<cstring>

class String {
private:
	char* m_Buffer;
	unsigned int m_Size;
public:
	String(const char* Init_Buffer) {
		m_Size = strlen(Init_Buffer);
		m_Buffer = new char[m_Size + 1];
		memcpy(m_Buffer, Init_Buffer, m_Size);
		m_Buffer[m_Size] = 0;
	}
	~String() {
		delete[] m_Buffer;
	}
	friend std::ostream& operator <<(std::ostream& stream, const String& MyString);
	char& operator [](const int& index) {
		return this->m_Buffer[index];
	}
};

std::ostream& operator <<(std::ostream& stream, const String& MyString) {
	stream << MyString.m_Buffer;
	return stream;
}

int main() {
	String s = "DvdBr3o";
	String s_copy = s;
	std::cout << s << std::endl;
	std::cout << s_copy << std::endl;
	s_copy[5] = '4';
	std::cout << s << std::endl;
	std::cout << s_copy << std::endl;
}
```

è¾“å‡ºï¼š

```
DvdBr3o
DvdBr3o
DvdBr4o
DvdBr4o
```

é™„åŠ æœ‰æŠ¥é”™ï¼Œå› ä¸ºä½ `delete`äº†åŸæŒ‡é’ˆåï¼Œä½ çš„å‰¯æœ¬æŒ‡é’ˆæ˜¯æ‚¬ç©ºçš„ï¼Œä½ åˆ`delete`æ‰äº†è¿™ä¸ªæ‚¬ç©ºæŒ‡é’ˆï¼Œæ‰€ä»¥æŠ¥é”™.

è€Œä¸”ä½ çš„ä¿®æ”¹è¢«åŒæ­¥äº†.

------

æƒ³è¦å•çº¯æ‹·è´è€Œä¸åŒæ­¥ä¿®æ”¹ï¼Œéœ€è¦åšåˆ°**æ·±æ‹·è´**ğŸ‘‡



## æ‹·è´æ„é€ å‡½æ•°

**åŠŸèƒ½**ï¼šå®ç°**æ·±æ‹·è´**

**å®ç°**ï¼š

```cpp
class ClassName{
public:
    ClassName(const ClassName& another) :
        ..., ... /*åˆå§‹åŒ–æˆå‘˜åˆ—è¡¨*/{
            .../*åˆå§‹åŒ–*/
        }
    ...
}
```

------

ä»¥ä¸Šä¸€ä¸ªåŒçº§æ ‡é¢˜çš„ä¾‹å­ä¸ºä¾‹ï¼Œå°†`String`ç±»æ·»åŠ ï¼š

```cpp
	String(const String& another) :
		m_Size(another.m_Size) {
		m_Buffer = new char[m_Size + 1];
		memcpy(m_Buffer, another.m_Buffer, m_Size + 1);
	}
```

è¾“å‡ºï¼š

```
DvdBr3o
DvdBr3o
DvdBr3o
DvdBr4o
```

ä¸€åˆ‡éƒ½æ­£å¸¸äº†.

------



## æ‹·è´æ„é€ å‡½æ•° åº”è¯¥æ³¨æ„çš„ ä¼˜åŒ–

------

è¿˜æ˜¯ä»¥`String`ä¸ºä¾‹å­ï¼Œæˆ‘ç›´æ¥è´´ä»£ç ï¼Œåé¢è®²æ”¹åŠ¨ï¼š

```cpp
#include<iostream>
#include<cstring>

class String {
private:
	char* m_Buffer;
	unsigned int m_Size;
public:
	String(const char* Init_Buffer) {
		m_Size = (unsigned int)strlen(Init_Buffer);
		m_Buffer = new char[m_Size + 1];
		memcpy(m_Buffer, Init_Buffer, m_Size);
		m_Buffer[m_Size] = 0;
		std::cout << "[DEBUG]:String Constructed!" << std::endl;
	}
	String(const String& another) :
		m_Size(another.m_Size) {
		m_Buffer = new char[m_Size + 1];
		memcpy(m_Buffer, another.m_Buffer, m_Size + 1);
		std::cout << "[DEBUG]:String Constructed as a copy!" << std::endl;
	}
	~String() {
		delete[] m_Buffer;
	}
	friend std::ostream& operator <<(std::ostream& stream, const String& MyString);
	friend void PrintString(String aString);
	char& operator [](const int& index) {
		return this->m_Buffer[index];
	}
};

std::ostream& operator <<(std::ostream& stream, const String& MyString) {
	stream << MyString.m_Buffer;
	return stream;
}

void PrintString(String aString) {
	std::cout << aString.m_Buffer << std::endl;
}

int main() {
	String s = "DvdBr3o";
	String s_copy = s;
	PrintString(s);
	PrintString(s_copy);
	/*s_copy[5] = '4';
	PrintString(s);
	PrintString(s_copy);*/
}
```

1 æ–°å¢`PrintString`å‡½æ•°ä½œä¸º`String`çš„å‹å…ƒ

2 `PrintString`å‡½æ•°ç”¨äºæ‰“å°`String`ç±»çš„`m_Buffer`ï¼Œä¸”è¯¥å‡½æ•°**æ²¡æœ‰ä½¿ç”¨å¸¸é‡å¼•ç”¨**.

3 `main`å‡½æ•°è‡ªå·±è¯»

çŒœçŒœç»“æœæ˜¯ä»€ä¹ˆï¼š

```
[DEBUG]:String Constructed!
[DEBUG]:String Constructed as a copy!
[DEBUG]:String Constructed as a copy!
DvdBr3o
[DEBUG]:String Constructed as a copy!
DvdBr3o
```

ä¹Ÿå°±æ˜¯ï¼ˆç¿»è¯‘æˆäººè¯çš„Outputï¼‰ï¼š

```
sè¢«åˆ›å»ºï¼
s_copyè¢«åˆ›å»ºä¸ºå‰¯æœ¬ï¼Œå¤åˆ¶äº†sï¼
PrintStringå‡½æ•°çš„å½¢å‚aStringè¢«åˆ›å»ºä¸ºå‰¯æœ¬ï¼Œå¤åˆ¶äº†sï¼
è¾“å‡ºå½¢å‚aString...
PrintStringå‡½æ•°çš„å½¢å‚aStringè¢«åˆ›å»ºä¸ºå‰¯æœ¬ï¼Œå¤åˆ¶äº†s_copyï¼
è¾“å‡ºå½¢å‚aString...
```

------

è¿™å°±æ˜¯å‡½æ•°ä¸ç”¨**å¸¸é‡å¼•ç”¨**çš„åæœ.

æˆ‘æ˜¯å®ç°äº†**æ·±æ‹·è´**ï¼Œå¯**å‡½æ•°è°ƒç”¨è¾“å‡º**åªç”¨**æµ…æ‹·è´**å•Šï¼Œä½ ç»™æˆ‘æä¸ª**æ·±æ‹·è´**å»åš**å½¢å‚**ä¸æ˜¯**æµªè´¹æ€§èƒ½**å—ï¼Ÿ

è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨**å¸¸é‡å¼•ç”¨**.